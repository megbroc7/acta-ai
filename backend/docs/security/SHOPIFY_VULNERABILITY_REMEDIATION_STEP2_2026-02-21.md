# Shopify Vulnerability Remediation (Step 2) - 2026-02-21

Scope:
- Shopify app dependency classification + build/runtime dependency handling.
- No functional feature changes.

## 1. Changes Applied

Updated `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/shopify-app/acta-blog-publisher/package.json`:
- Moved build/dev tooling from `dependencies` to `devDependencies`:
  - `@remix-run/dev`
  - `@remix-run/fs-routes`
  - `@shopify/cli`
  - `vite-tsconfig-paths`

Updated `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/shopify-app/acta-blog-publisher/Dockerfile`:
- Aligned runtime/build base image to Node 22 (`FROM node:22-alpine`) to satisfy app engine requirements.
- Changed install/build flow to:
  1. `npm ci --include=dev`
  2. `npm run build`
  3. `npm prune --omit=dev && npm cache clean --force`

Rationale:
- Build tooling remains available for build-time.
- Production runtime image is pruned to production dependencies.
- `npm audit --omit=dev` now reflects production runtime dependency risk.
- `engine-strict=true` with `engines.node >=20.19 <22 || >=22.12` is now compatible in container builds.

## 2. Lockfile Update

Regenerated lockfile metadata under Node 22:

```bash
export PATH="/opt/homebrew/opt/node@22/bin:$PATH"
npm install --package-lock-only
```

Updated:
- `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/shopify-app/acta-blog-publisher/package-lock.json`

## 3. Audit Before vs After

Before (baseline, prod-only):
- Artifact: `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/backend/docs/security/npm-audit-shopify-app-prodonly-2026-02-21.json`
- Result: `12 total`, `6 high`, `6 moderate`, `0 critical`

After Step 2 (prod-only):
- Artifact: `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/backend/docs/security/npm-audit-shopify-app-prodonly-2026-02-21-after-step2.json`
- Result: `0 total`, `0 high`, `0 moderate`, `0 critical`

Full audit (including dev) after Step 2:
- Artifact: `/Users/meganbroccoli/Desktop/Sabina/Web Services/Acta AI/backend/docs/security/npm-audit-shopify-app-2026-02-21-after-step2.json`
- Result: `35 total`, `28 high`, `7 moderate`, `0 critical`

Interpretation:
- Launch-gate production risk (`--omit=dev`) is cleared by this Step 2 change set.
- Remaining findings are in dev tooling graph and should not ship in production runtime when using the updated Docker flow.

## 4. Build Validation

Validated successful build under Node 22:

```bash
export PATH="/opt/homebrew/opt/node@22/bin:$PATH"
npm run build
```

Result:
- Build completed successfully.
- Existing CSS warning remained (`Expected "(" but found "print"`), non-blocking and pre-existing.
