# Dependency Vulnerability Scan + Triage (2026-02-20)

Scope:
- Backend Python dependencies (`backend/requirements.txt`)
- Frontend React app (`frontend/package-lock.json`)
- Shopify app (`shopify-app/acta-blog-publisher/package-lock.json`)

Scan artifacts:
- `backend/docs/security/pip-audit-backend-2026-02-20.json`
- `backend/docs/security/pip-audit-backend-2026-02-20-after-fixes.json`
- `backend/docs/security/npm-audit-frontend-2026-02-20.json`
- `backend/docs/security/npm-audit-frontend-prodonly-2026-02-20.json`
- `backend/docs/security/npm-audit-shopify-app-2026-02-20.json`
- `backend/docs/security/npm-audit-shopify-app-prodonly-2026-02-20.json`
- `backend/docs/security/npm-audit-shopify-app-2026-02-21.json`
- `backend/docs/security/npm-audit-shopify-app-prodonly-2026-02-21.json`
- `backend/docs/security/npm-audit-shopify-app-2026-02-21-after-step2.json`
- `backend/docs/security/npm-audit-shopify-app-prodonly-2026-02-21-after-step2.json`

## 1. Executive Summary

- Backend: started with **11 vulnerabilities in 5 packages**, reduced to **3 vulnerabilities in 2 packages** after dependency upgrades.
- Frontend: **7 vulnerabilities (4 high)** in full audit, but **0 vulnerabilities** in production-only (`--omit=dev`) audit.
- Shopify app: baseline snapshot showed **12 vulnerabilities (6 high)** in production-only audit; follow-up remediation on 2026-02-21 reduced production-only findings to **0**.

## 2. Backend Remediation Applied

Updated `backend/requirements.txt`:
- `python-jose[cryptography]` from `3.3.0` -> `3.4.0`
- `python-multipart` from `0.0.12` -> `0.0.22`
- `cryptography` from `43.0.1` -> `46.0.5`

Validation:
- Backend tests: `35 passed` after upgrades.

## 3. Triage Disposition

### 3.1 Backend (Remaining 3)

1. `starlette` (`CVE-2024-47874`, `CVE-2025-54121`)
- Severity context: DoS risk tied to multipart/form parsing behavior.
- Status: **Deferred (requires framework upgrade)**.
- Why deferred: Current `fastapi==0.115.0` pins Starlette `<0.39.0`; fixed Starlette versions are `>=0.40.0` and `>=0.47.2`, requiring FastAPI stack upgrade and regression pass.
- Compensating controls:
  - Edge protections already in place/added at nginx layer.
  - No known high-volume multipart upload path in current core flows.
- Action: Plan a controlled FastAPI/Starlette upgrade work item in Week 2/3 with full regression testing.

2. `ecdsa` (`CVE-2024-23342`)
- Severity context: timing side-channel in specific ECDSA signing scenarios; no upstream fix published.
- Status: **Accepted with constraints**.
- Why accepted: App token flow uses `HS256` JWT signing, not ECDSA signing operations.
- Action: Keep under periodic review; consider moving to libraries/minimal crypto surface that exclude unused ECDSA paths.

### 3.2 Frontend App

1. Full audit result: 7 vulnerabilities (eslint/minimatch/ajv toolchain).
- Status: **Accepted (dev-tooling only)**.
- Evidence: Production-only scan (`npm audit --omit=dev`) returned `0`.
- Rationale: Affected packages are lint/build-time dependencies and not served in the runtime nginx static bundle.

### 3.3 Shopify App

1. Baseline (2026-02-21):
- Full audit: 35 vulnerabilities (28 high).
- Production-only audit: 12 vulnerabilities (6 high), centered on `@remix-run/dev` transitive chain (`@npmcli/package-json`, `cacache`, `glob`, `minimatch`, `tar`).
2. Remediation (2026-02-21):
- Reclassified build-only packages to `devDependencies` (`@remix-run/dev`, `@remix-run/fs-routes`, `@shopify/cli`, `vite-tsconfig-paths`).
- Updated Docker flow to build with dev deps and prune runtime deps, with Node 22 base image to satisfy `engine-strict` + `engines.node`.
3. Post-remediation results:
- Full audit remains 35 vulnerabilities (dev-tooling graph).
- Production-only audit is **0 vulnerabilities** (`0 high`, `0 critical`).
- Status: **Production risk remediated; dev-tooling findings accepted as non-runtime**.
- Evidence:
  - `backend/docs/security/SHOPIFY_VULNERABILITY_BASELINE_2026-02-21.md`
  - `backend/docs/security/SHOPIFY_VULNERABILITY_REMEDIATION_STEP2_2026-02-21.md`
  - `backend/docs/security/SHOPIFY_STEP4_REGRESSION_VALIDATION_2026-02-21.md`

## 4. Week 1 Checklist Mapping

Checklist item:
- `Run dependency vulnerability scan and triage all findings.`

Completion state:
- **Scan complete** with persisted JSON evidence.
- **Triage complete** with package-by-package disposition and remediation actions.
- **Partial remediation complete** on backend (reduced 11 -> 3 findings).
- **Shopify production blocker resolved**: production-only findings reduced from `12` (`6 high`) to `0`.
